name: Validate Commits

on:
    pull_request:
        types: [opened, edited, synchronize, reopened]

jobs:
    validate:
        name: Validate Commit Messages
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v5
              with:
                  fetch-depth: 0

            - name: Validate PR title
              uses: amannn/action-semantic-pull-request@v5
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  # Types allowed in your conventions.md
                  types: |
                      feat
                      fix
                      refactor
                      docs
                      test
                      chore
                      style
                      perf
                      ci
                      build
                      revert
                  # Scopes matching your monorepo structure
                  scopes: |
                      deps
                      backend
                      frontend
                      application
                      domain
                      infrastructure
                      ci
                      release
                  # Require scope for better organization
                  requireScope: false
                  # Allow empty scope
                  subjectPattern: ^(?![A-Z]).+$
                  subjectPatternError: |
                      The subject "{subject}" found in the PR title "{title}"
                      didn't match the configured pattern. Please ensure that the subject
                      doesn't start with an uppercase character.

            - name: Validate commit messages
              uses: wagoid/commitlint-github-action@v6
              with:
                  configFile: commitlint.config.mjs
